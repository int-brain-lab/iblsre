<IfModule mod_ssl.c>
    <VirtualHost *:80>
        ServerName ${APACHE_SERVER_NAME}
        <If "%{HTTP_HOST} != 'localhost' && %{HTTP_HOST} != '127.0.0.1'">
            Redirect permanent / https://${APACHE_SERVER_NAME}/
        </If>
    </VirtualHost>

    <VirtualHost *:443>
        ServerName ${APACHE_SERVER_NAME}

        Include sites-available/alyx-common.conf

        # Configurations for easy maintenance mode
        RewriteEngine On
        RewriteCond %{ENV:REDIRECT_STATUS} !=503
        RewriteCond "/var/www/alyx/maintenance.trigger" -f
        RewriteRule ^(.*)$ /$1 [R=503,L]

# autoconfig
SSLCertificateFile /etc/letsencrypt/live/${APACHE_SERVER_NAME}/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/${APACHE_SERVER_NAME}/privkey.pem
Include sites-available/options-ssl-apache.conf

    </VirtualHost>
</IfModule>
<IfModule !mod_ssl.c>
    <VirtualHost *:80>
        ServerName localhost
        Include sites-available/alyx-common.conf
    </VirtualHost>
</IfModule>
